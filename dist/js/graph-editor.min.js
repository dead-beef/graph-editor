"use strict";!function(t,e){"function"==typeof define&&define.amd?define(["d3"],e):"object"==typeof module&&module.exports?module.exports=e(require("d3")):t.ge=e(t.d3)}(this,function(a){var t={},p=t;return p.GraphEditor=function(t,e,i){return t.select||(t=a.select(t)),this.initOptions(i,t).initSvg(t).initData(e).initState(),this.dispatch=a.dispatch("node-click","link-click","new-link-start","new-link-end","new-link-cancel","click","simulation-start","simulation-stop"),this.bbox=[[0,0],[0,0]],this.zoom=this.zoomEvents(a.zoom()).scaleExtent([this.options.scale.min,this.options.scale.max]),this.drag=this.dragEvents(a.drag()),this.svg.call(this.zoom),this.onresize=p.bind(this,this.resized),window.addEventListener("resize",this.onresize),this.updateBBox(),setTimeout(p.bind(this,function(){this.update().resized().simulation(this.options.simulation.start)}),10),this},p.Point=function(t,e){this.x=+t||0,this.y=+e||0},p.BBox=function(t,e,i,n){this.left=+t||0,this.top=+e||0,this.right=+i||0,this.bottom=+n||0},p.Angle=function(t,e){this.deg=0,this.rad=0,e?(this.rad=+t||0,this.deg=180*this.rad/Math.PI):(this.deg=+t||0,this.rad=this.deg*Math.PI/180),this.sin=Math.sin(this.rad),this.cos=Math.cos(this.rad)},p.ContainerSize=function(t,e,i){this.minWidth=+t||1,this.minHeight=+e||1,this.minArea=+i||this.minWidth*this.minHeight},p.SaveLoad=function(){this.classes={}},p.SaveLoad.prototype.addClass=function(t,e,i){if(e=e||t.name,this.classes[e]&&!i)throw new Error('class "'+e+'" exists');this.classes[e]=t},p.SaveLoad.prototype.getClass=function(t){var e=this.classes[t];if(!e)throw new Error('class "'+t+'" not found');return e},p.SaveLoad.prototype.fromJson=function(t){return new(this.getClass(t.class))(t)},p.SaveLoad.prototype.toJson=function(t,e){var i=t.toJson();return i.class=e||t.constructor.name,i},p.id=function(t){return t&&t.id||null},p.bind=function(t,e){return function(){return e.apply(t,arguments)}},p.equal=function(t,e,i){i=i||1e-5;var n=function(t,e){return Math.abs(t-e)<i};if(null===t||null===e||void 0===t||void 0===e||"number"==typeof t&&Array.isArray(e)||"number"==typeof e&&Array.isArray(t))return!1;if("number"==typeof t&&"number"==typeof e)return n(t,e);if(!Array.isArray(t)||!Array.isArray(e))throw new Error("ge.equal: invalid argument type: ".concat(t.toString()," ",e.toString()));if(t.length!==e.length)return!1;for(var s=0;s<t.length;++s)if(!n(t[s],e[s]))return!1;return!0},p.defaultSimulation=function(t,e,i){t||(t=a.forceSimulation().force("charge",a.forceManyBody()).force("link",a.forceLink()).force("center",a.forceCenter()));var n=10*a.max(e,function(t){return Math.max(t.width,t.height)}),s=a.mean(e,function(t){return t.x}),o=a.mean(e,function(t){return t.y});return t.nodes(e),t.force("center").x(s).y(o),t.force("link").links(i).distance(n),t},p._extend=function(t,e){if(!e)return t;if("object"!=typeof e)throw new Error("src is not an object: "+e.toString());if(t){if("object"!=typeof t)throw new Error("dst is not an object: "+t.toString())}else t={};for(var i in e){var n=e[i];if("object"==typeof n&&null!==n)if(Array.isArray(n))t[i]=n.slice();else{var s=t[i];s&&"object"==typeof s&&!Array.isArray(s)||(t[i]=s={}),p._extend(s,n)}else t[i]=n}return t},p.extend=function(t,e){for(var i=1;i<arguments.length;++i)t=p._extend(t,arguments[i]);return t},p.path=new p.SaveLoad,p.path.Path=function t(e){if(this.constructor===t)throw new Error("abstract class");e=e||{},this.loopStart=new p.Angle(+e.loopStart||180),this.loopEnd=new p.Angle(+e.loopEnd||270)},p.path.Path.prototype.path=function(t){throw new Error("abstract method")},p.path.Path.prototype.toJson=function(){return{loopStart:this.loopStart.deg,loopEnd:this.loopEnd.deg}},p.path.Line=function(t){p.path.Path.call(this,t)},p.path.Line.prototype=Object.create(p.path.Line),Object.defineProperty(p.path.Line.prototype,"constructor",{value:p.path.Line,enumerable:!1,writable:!0}),p.path.addClass(p.path.Line),p.path.Line.prototype.path=function(t){var e,i;if(t.source===t.target){e=t.source.shape.getPoint(t.source,this.loopStart),i=t.source.shape.getPoint(t.source,this.loopEnd);var n=t.source.width/2,s=t.source.height/2;return t.reversed=!1,t.path="M".concat(e.x,",",e.y,"A",n,",",s,",0,1,0,",i.x,",",i.y),t.path}e=new p.Point(t.source.x,t.source.y),i=new p.Point(t.target.x,t.target.y);var o=t.source.shape.intersect(t.source,t.target);return e=o||e,i=t.target.shape.intersect(t.target,t.source)||i,t.path="M".concat(e.x,",",e.y,"L",i.x,",",i.y),(t.reversed=e.x>i.x)&&(o=e,e=i,i=o),"M".concat(e.x,",",e.y,"L",i.x,",",i.y)},p.shape=new p.SaveLoad,p.shape.Shape=function t(e){if(this.constructor===t)throw new Error("abstract class")},p.shape.Shape.prototype.path=function(t){throw new Error("abstract method")},p.shape.Shape.prototype.getPoint=function(t,e){throw new Error("abstract method")},p.shape.Shape.prototype.doFitTitleInside=function(t,e,i){throw new Error("abstract method")},p.shape.Shape.prototype.toJson=function(){return{}},p.shape.Shape.prototype.intersect=function(t,e){var i=Math.atan2(e.y-t.y,e.x-t.x);return this.getPoint(t,new p.Angle(i,!0))},p.shape.Shape.prototype.fitTitleInside=function(t,e){if(t.title!==t.prevTitle){var i=e.containerSize(t.title);this.doFitTitleInside(t,i,e),t.prevTitle=t.title}},p.shape.Circle=function(t){p.shape.Shape.call(this,t)},p.shape.Circle.prototype=Object.create(p.shape.Shape.prototype),Object.defineProperty(p.shape.Circle.prototype,"constructor",{value:p.shape.Circle,enumerable:!1,writable:!0}),p.shape.addClass(p.shape.Circle),p.shape.Circle.prototype.path=function(t){var e=t.width,i=e/2,n=t.height/2,s="a".concat(i,",",n,",0,1,0,");return"M".concat(-i,",0",s,e,",0",s,-e,",0")},p.shape.Circle.prototype.getPoint=function(t,e){return new p.Point(t.x+t.width*e.cos*.5,t.y+t.height*e.sin*.5)},p.shape.Circle.prototype.doFitTitleInside=function(t,e){t.width=t.height=Math.max(Math.ceil(Math.sqrt(2*e.minArea)),e.minWidth,e.minHeight),t.textWidth=t.textHeight=Math.ceil(t.width/1.414213)},p.shape.Rect=function(t){t=t||{},p.shape.Shape.call(this,t),this.aspect=t.aspect||1},p.shape.Rect.prototype=Object.create(p.shape.Shape.prototype),Object.defineProperty(p.shape.Rect.prototype,"constructor",{value:p.shape.Rect,enumerable:!1,writable:!0}),p.shape.addClass(p.shape.Rect),p.shape.Rect.prototype.toJson=function(){return{aspect:this.aspect}},p.shape.Rect.prototype.path=function(t){var e=t.width,i=t.height;return"M".concat(-e/2,",",-i/2,"l",e,",0l0,",i,"l",-e,",0z")},p.shape.Rect.prototype.getPoint=function(t,e){var i,n,s=t.width/2,o=t.height/2,r=new p.Point(t.x,t.y);return i=null,1e-8<e.cos?i=s:e.cos<-1e-8&&(i=-s),null!==i&&(n=i/e.cos*e.sin)<o+1e-8&&-o-1e-8<n?(r.x+=i,r.y+=n):(n=null,1e-8<e.sin?n=o:e.sin<-1e-8&&(n=-o),null!==n&&(i=n/e.sin*e.cos)<s+1e-8&&-s-1e-8<i&&(r.x+=i,r.y+=n)),r},p.shape.Rect.prototype.doFitTitleInside=function(t,e){t.width=Math.max(Math.ceil(this.aspect*Math.sqrt(e.minArea)),e.minWidth),t.height=Math.max(e.minHeight,t.width/this.aspect),t.textWidth=t.width,t.textHeight=t.height},p.GraphEditor.prototype.isLinkData=function(t){return void 0!==t.source},p.GraphEditor.prototype.getElement=function(t){return null===t?null:t.select?t:t instanceof SVGElement?a.select(t):("object"!=typeof t&&(t=this.nodeById[t]||this.linkById[t]),t?this.svg.select(t.selector):null)},p.GraphEditor.prototype.getData=function(t){return null===t?null:t.select?t.datum():t instanceof SVGElement?a.select(t).datum():"object"!=typeof t?this.nodeById[t]||this.linkById[t]:t},p.GraphEditor.prototype.nodeId=function(){var t=1+a.max(this.data.nodes,function(t){return t.id});return isNaN(t)&&(t=0),t},p.GraphEditor.prototype.linkId=function(t,e){var i=t.id,n=e.id;if(!this.options.directed&&n<i){var s=i;i=n,n=s}return i+"-"+n},p.GraphEditor.prototype.addNode=function(t,e){return t=new p.Node(this,t),this.nodeById[t.id]?null:(this.nodeById[t.id]=t,this.data.nodes.push(t),e||this.update(),t)},p.GraphEditor.prototype.addLink=function(t,e){return t=new p.Link(this,t),this.linkById[t.id]?null:(this.linkById[t.id]=t,this.data.links.push(t),e||this.update(),t)},p.GraphEditor.prototype.addNodes=function(t,e){for(var i=0;i<t.length;++i)this.addNode(t[i],!0);e||this.update()},p.GraphEditor.prototype.addLinks=function(t,e){for(var i=0;i<t.length;++i)this.addLink(t[i],!0);e||this.update()},p.GraphEditor.prototype.add=function(t,e){var i=this;Array.isArray(t)?(t.forEach(function(t){i.isLinkData(t)?i.addLink(t,!0):i.addNode(t,!0)}),e||i.update()):(t=i.getData(t),i.isLinkData(t)?i.addLink(t,e):i.addNode(t,e))},p.GraphEditor.prototype._removeLink=function(t){this.state.selectedLink===this.data.links[t]&&this.selectLink(null),delete this.linkById[this.data.links[t].id],this.data.links.splice(t,1)},p.GraphEditor.prototype.removeLink=function(t,e){if(!(t=this.getData(t)))return!1;var i=this.data.links.indexOf(t);return i<0?(console.error("removeLink",t,"indexOf() < 0"),!1):(this._removeLink(i),e||this.update(),!0)},p.GraphEditor.prototype.removeNode=function(t,e){if(!(t=this.getData(t)))return!1;var i=this.data.nodes.indexOf(t);if(i<0)return console.error("removeNode",t," indexOf() < 0"),!1;this.state.selectedNode===t&&this.selectNode(null),this.data.nodes.splice(i,1),delete this.nodeById[t.id],i=0;for(var n=this.data.links;i<n.length;)n[i].source===t||n[i].target===t?this._removeLink(i):++i;return e||this.update(),!0},p.GraphEditor.prototype._remove=function(t,e){return t=this.getData(t),this.isLinkData(t)?this.removeLink(t,e):this.removeNode(t,e)},p.GraphEditor.prototype.remove=function(t,e){var i=this;return Array.isArray(t)?(t.forEach(function(t){i._remove(t,!0)}),void(e||i.update())):i._remove(t,e)},p.GraphEditor.prototype.selectNode=function(e,t){if(void 0===e)return this.state.selectedNode;if(e=this.getData(e),this.state.selectedNode===e&&!t)return this;var i=this.options.css.selection.node;if(!(this.state.selectedNode=e))return this.svg.classed(i,!1),this.nodes.classed(i,!1),this.links.classed(i,!1),this;var n,s=function(t){return t===e};return n=this.options.directed?function(t){return t.source===e}:function(t){return t.source===e||t.target===e},this.svg.classed(i,!0),this.nodes.classed(i,s),this.links.classed(i,n),this.nodes.filter(s).raise(),this.links.filter(n).raise(),this},p.GraphEditor.prototype.selectLink=function(e,t){if(void 0===e)return this.state.selectedLink;if(e=this.getData(e),this.state.selectedLink===e&&!t)return this;var i=this.options.css.selection.link;if(!(this.state.selectedLink=e))return this.svg.classed(i,!1),this.links.classed(i,!1),this;var n=function(t){return t===e};return this.svg.classed(i,!0),this.links.classed(i,n),this.links.filter(n).raise(),this},p.GraphEditor.prototype.select=function(t,e){return void 0===t?{node:this.state.selectedNode,link:this.state.selectedLink}:null===t?this.selectNode(null).selectLink(null):(t=this.getData(t))?this.isLinkData(t)?this.selectLink(t,e):this.selectNode(t,e):this},p.GraphEditor.prototype.startSimulation=function(t){var e=this;if(void 0===t&&(t=this.options.simulation.stop),this.state.simulationStarted)return t?this.state.simulation.on("end",function(){e.stopSimulation()}):this.state.simulation.on("end",null),this;this.state.simulationStarted=!0,this.state.simulation=this.options.simulation.create.call(this,this.state.simulation,this.data.nodes,this.data.links);var i=0;return this.state.simulation.on("tick",function(){++i>=e.options.simulation.step&&(i=0,e.update(!0))}),t?this.state.simulation.on("end",function(){e.stopSimulation()}):this.state.simulation.on("end",null),this.state.simulation.alpha(1).restart(),this.dispatch.call("simulation-start",this),this},p.GraphEditor.prototype.stopSimulation=function(){return this.state.simulationStarted&&(this.state.simulation.stop(),this.state.simulationStarted=!1,this.dispatch.call("simulation-stop",this)),this},p.GraphEditor.prototype.simulation=function(t){return void 0===t?this.state.simulationStarted:"restart"===t?this.state.simulationStarted?(this.state.simulation.alpha(1).restart(),this):this.startSimulation():("toggle"===t&&(t=!this.state.simulationStarted),t&&"stop"!==t?this.startSimulation():this.stopSimulation())},p.GraphEditor.prototype.dragToLink=function(t){return void 0===t?this.state.dragToLink:("toggle"===t&&(t=!this.state.dragToLink),this.state.dragToLink=t,this)},p.GraphEditor.prototype.clear=function(t){return t=t||void 0===t,this.simulation(!1),this.nodes=this.nodes.data([],p.id),this.nodes.exit().remove(),this.links=this.links.data([],p.id),this.links.exit().remove(),this.defs=this.defs.data([],p.id),this.defs.exit().remove(),t&&(this.nodeById={},this.linkById={},this.data={nodes:[],links:[]},this.initState()),this},p.GraphEditor.prototype.redraw=function(){return this.clear(!1).update()},p.GraphEditor.prototype.destroy=function(){var t=this.options.css;return this.clear(),this.svg.classed(t.graph,!1).classed(t.digraph,!1).classed(t.selection.node,!1).classed(t.selection.link,!1).on(".zoom",null).html(""),window.removeEventListener("resize",this.onresize),this},p.GraphEditor.prototype.toJson=function(){var e=this;return{nodes:this.data.nodes.map(function(t){return t.toJson(e,e.bbox[0][0],e.bbox[0][1])}),links:this.data.links.map(function(t){return t.toJson(e)})}},p.GraphEditor.prototype.on=function(t,e){return this.dispatch.on(t,e),this},p.GraphEditor.prototype.clickPosition=function(t){return t=t||this.container.node(),a.touch(t)||a.mouse(t)},p.GraphEditor.prototype.touchedNode=function(){for(var t=a.event.touches[0].pageX,e=a.event.touches[0].pageY,i=document.elementFromPoint(t,e),n=this.options.css.node;;){if(!i)return null;switch(i.tagName.toLowerCase()){case"svg":case"body":return null;case"g":if(i.classList.contains(n))return a.select(i).datum()}i=i.parentNode}},p.GraphEditor.prototype.dragEvents=function(t){var n=this;return t.on("start",function(t){n.state.dragged=!1,n.state.dragPos=null,a.select(this).raise(),n.state.simulationStarted&&!n.state.dragToLink&&(t.fx=t.x,t.fy=t.y,n.simulation("restart"))}).on("drag",function(t){if(n.state.dragToLink){var e=n.clickPosition(),i="".concat("M",t.x,",",t.y,"L",e[0],",",e[1]);n.state.dragged?n.transition(n.dragLine,"drag").attr("d",i):(n.state.dragged=!0,n.dragLine.classed(n.options.css.hide,!1).attr("d",i),n.dispatch.call("new-link-start",n,t))}else n.state.dragged=!0,t.x+=a.event.dx,t.y+=a.event.dy,n.state.simulationStarted&&(t.fx=t.x,t.fy=t.y,n.simulation("restart")),n.updateNode(this)}).on("end",function(t){if(t.fx=null,t.fy=null,n.state.dragPos=n.clickPosition(),n.state.dragged)if(n.state.dragged=!1,n.state.dragToLink)if(n.dragLine.classed(n.options.css.hide,!0),n.state.newLinkTarget){var e=n.state.newLinkTarget;n.state.newLinkTarget=null,n.dispatch.call("new-link-end",n,t,e)}else n.dispatch.call("new-link-cancel",n,t);else n.state.simulationStarted&&n.simulation("restart");else n.dispatch.call("node-click",n,t)})},p.GraphEditor.prototype.zoomEvents=function(t){var e=this;return t.duration(e.options.transition.zoom).on("end",function(){if(!e.state.zoomed){var t=e.clickPosition();p.equal(e.state.dragPos,t)?e.state.dragPos=null:e.dispatch.call("click",e,t)}e.state.zoomed=!1}).on("zoom",function(){var t;e.state.zoomed=!0,p.equal(a.event.transform.k,e.state.zoom)?t="drag":(t="zoom",e.state.zoom=a.event.transform.k),e.transition(e.container,t,"zoom").attr("transform",a.event.transform.toString())})},p.GraphEditor.prototype.linkEvents=function(t){var e=this;return t.on("mousedown",function(){a.event.stopPropagation(),a.event.preventDefault()}).on("touchstart",function(){e.state.dragPos=e.clickPosition()}).on("mouseup",function(t){a.event.stopPropagation(),a.event.preventDefault(),e.dispatch.call("link-click",e,t)})},p.GraphEditor.prototype.nodeEvents=function(t){var e=this;return t.on("mouseover",function(t){e.state.dragToLink&&(e.state.newLinkTarget=t)}).on("mouseout",function(){e.state.dragToLink&&(e.state.newLinkTarget=null)}).on("touchmove",function(){e.state.dragToLink&&(e.state.newLinkTarget=e.touchedNode())}).call(e.drag)},p.GraphEditor.prototype.initMarkers=function(t){var e=t.append("svg:defs");return e.append("marker").attr("id","ge-dragline-end").attr("viewBox","0 -7 12 14").attr("refX","7").attr("refY","0").attr("markerWidth",3.5).attr("markerHeight",3.5).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5Z"),e.append("marker").attr("id","ge-dragline-start").attr("viewBox","-5 -5 5 5").attr("refX",-2).attr("refY",-2).attr("markerWidth",4).attr("markerHeight",4).append("circle").attr("r",2).attr("cx",-2).attr("cy",-2),this},p.GraphEditor.prototype.initSvg=function(t){t.attr("id",this.options.id).classed(this.options.css.graph,!0).classed(this.options.css.digraph,this.options.directed),this.initMarkers(t);var e=t.append("g"),i=t.select("defs"),n=e.append("g"),s=e.append("g");return this.container=e,this.defs=i.selectAll("."+this.options.css.textpath),this.links=n.selectAll("g"),this.nodes=s.selectAll("g"),this.dragLine=e.append("path").classed(this.options.css.dragline,!0).classed(this.options.css.hide,!0).attr("marker-start","url(#ge-dragline-start)").attr("marker-end","url(#ge-dragline-end)").attr("d","M0,0L0,0"),this.textSize=new p.TextSize(t.append("text").classed(this.options.css.node,!0).node()),this.svg=t,this},p.GraphEditor.prototype.initData=function(t){return this.nodeById={},this.linkById={},this.data={nodes:[],links:[]},this.addNodes(t.nodes,!0),this.addLinks(t.links,!0),this},p.GraphEditor.prototype.initState=function(){return this.state={zoomed:!1,dragged:!1,simulation:null,simulationStarted:!1,dragToLink:!1,newLinkTarget:null,selectedNode:null,selectedLink:null,dragPos:null,zoom:1},this},p.Link=function(t,e){if(this.source=t.getData(e.source),!this.source)throw new Error("invalid link source");if(this.target=t.getData(e.target),!this.target)throw new Error("invalid link target");return this.id=t.linkId(this.source,this.target),this.shape=e.shape?p.path.fromJson(e.shape):t.options.link.shape,this.title=void 0===e.title?this.id:e.title,this.data=e.data,this.path="",this.reversed=!1,this.elementId=t.options.id.concat("l",this.id),this.selector="#"+this.elementId,this.pathId=t.options.id.concat("p",this.id),this.pathSelector="#"+this.pathId,this.defId=t.options.id.concat("d",this.id),this.defSelector="#"+this.defId,this},p.Link.initSelection=function(t,e,i){e.attr("id",function(t){return t.defId}),t.attr("id",function(t){return t.pathId}),t.append("path"),t.append("text").attr("dx",i.text.dx).attr("dy",i.text.dy).append("textPath").attr("xlink:href",function(t){return t.defSelector})},p.Link.updateSelection=function(t,e,i,n){n(e).attr("d",function(t){return t.shape.path(t)}),n(t.select("path")).style("stroke-width",function(t){return t.size+"px"}).attr("d",function(t){return t.path});var s=i.text.offset,o=i.text.anchor;n(t.select("textPath")).text(function(t){return t.title}).attr("startOffset",function(t){return s[+t.reversed]}).attr("text-anchor",function(t){return o[+t.reversed]})},p.Link.prototype.initSelection=p.Link.initSelection,p.Link.prototype.updateSelection=p.Link.updateSelection,p.Link.prototype.update=function(){this.shape(this)},p.Link.prototype.toJson=function(t){return{id:this.id,source:this.source.id,target:this.target.id,size:this.size,title:this.title,data:this.data,shape:this.shape===t.options.link.shape?null:p.path.toJson(this.shape)}},p.Node=function(t,e){var i=t.options.node;return this.id=e.id||t.nodeId(),this.x=+e.x||0,this.y=+e.y||0,this.width=Math.max(+e.width||i.size.def,i.size.min),this.height=Math.max(+e.height||i.size.def,i.size.min),this.shape=e.shape?p.shape.fromJson(e.shape):i.shape,this.title=null==e.title?this.id.toString():e.title,this.textX=null,this.textY=null,this.textWidth=null,this.textHeight=null,this.textInside=i.text.inside,this.textSize=t.textSize,this.data=e.data,this.elementId=t.options.id.concat("n",this.id),this.selector="#"+this.elementId,this.transform=null,this.prevTitle=null,this},p.Node.initSelection=function(t){t.attr("id",function(t){return t.elementId}),t.append("path"),t.append("foreignObject").append("xhtml:div").append("xhtml:span")},p.Node.updateSelection=function(t,e,i){console.log(t),e(t).attr("transform",function(t){return"translate(".concat(t.x,",",t.y,")")}),t.each(function(t){t.shape.fitTitleInside(t,i)}),e(t.select("foreignObject")).attr("x",function(t){return-t.textWidth/2}).attr("y",function(t){return-t.textHeight/2}).attr("width",function(t){return t.textWidth}).attr("height",function(t){return t.textHeight}).select("span").text(function(t){return t.title}),e(t.select("path")).attr("d",function(t){return t.shape.path(t)})},p.Node.prototype.initSelection=p.Node.initSelection,p.Node.prototype.updateSelection=p.Node.updateSelection,p.Node.prototype.update=function(){var t=!1;this.textInside&&this.shape.fitTextInside(this);var e="translate(".concat(this.x,",",this.y,")");return e!==this.transform&&(this.transform=e,t=!0),t},p.Node.prototype.toJson=function(t,e,i){return{id:this.id,x:this.x-e,y:this.y-i,width:this.width,height:this.height,shape:this.shape===t.options.node.shape?null:p.shape.toJson(this.shape),title:this.title,data:this.data}},p.GraphEditor.prototype.defaults={id:null,directed:!1,node:{shape:new p.shape.Circle,border:2,size:{def:10,min:10},text:{dx:0,dy:0,inside:!0}},link:{shape:new p.path.Line({loopStart:0,loopEnd:90}),size:{def:2},text:{dx:0,dy:"1.1em",offset:null,anchor:null}},simulation:{create:p.defaultSimulation,start:!1,stop:!0,step:1},transition:{zoom:250,drag:0,simulation:50},scale:{min:.25,max:8},bbox:{padding:80},css:{node:"ge-node",graph:"ge-graph",digraph:"ge-digraph",hide:"ge-hidden",dragline:"ge-dragline",link:"ge-link",textpath:"ge-text-path",selection:{node:"ge-selection",link:"ge-link-selection"}}},p.GraphEditor.prototype.typeDefaults=[{link:{id:function(t){return"".concat(Math.min(t.source.id,t.target.id),"-",Math.max(t.source.id,t.target.id))},text:{offset:"50%",anchor:"middle"}}},{link:{id:function(t){return"".concat(t.source.id,"-",t.target.id)},text:{offset:"20%",anchor:"start"}}}],p.GraphEditor.prototype.initOptions=function(t,e){var i;i=t&&t.hasOwnProperty("directed")?t.directed:this.defaults.directed;var n=this.typeDefaults[+i],s=p.extend({},this.defaults,n,t);s.id=s.id||e.attr("id")||"ge".concat(Math.floor(100*Math.random()));var o=100-parseInt(s.link.text.offset)+"%";switch(s.link.text.offset=[s.link.text.offset,o],s.link.text.anchor){case"start":o="end";break;case"end":o="start";break;default:o="middle"}return s.link.text.anchor=[s.link.text.anchor,o],this.options=s,this},p.TextSize=function(t){return t.setAttribute("style","stroke:none;fill:none"),this.el=t,this},p.TextSize.prototype.width=function(t){return this.el.textContent=t,this.el.getComputedTextLength()},p.TextSize.prototype.size=function(t){this.el.textContent=t;var e=this.el.getBBox();return new p.Point(e.width,e.height)},p.TextSize.prototype.containerSize=function(t){var e,i=this.size(t),n=t.split(/\s+/);if(1==n.length)e=i.x;else{e=0;var s=this;n.forEach(function(t){e=Math.max(e,s.width(t))})}return new p.ContainerSize(e,i.y,i.x*i.y)},p.GraphEditor.prototype.transition=function(t,e,i){var n=this.options.transition[e];return n?t.transition(i).duration(n):t},p.GraphEditor.prototype.resized=function(){return this.updateExtent(),this.zoom.translateTo(this.container,0,0),this},p.GraphEditor.prototype.updateSimulation=function(){return this.state.simulation&&(this.state.simulation=this.options.simulation.create.call(this,this.state.simulation,this.data.nodes,this.data.links).alpha(1)),this},p.GraphEditor.prototype.updateBBox=function(t){var e=this.data.nodes,i=this.options.bbox.padding;if(void 0===t){var n=a.min(e,function(t){return t.x}),s=a.min(e,function(t){return t.y}),o=a.max(e,function(t){return t.x+t.width}),r=a.max(e,function(t){return t.y+t.height});this.bbox[0][0]=(n||0)-i,this.bbox[1][0]=(o||0)+i,this.bbox[0][1]=(s||0)-i,this.bbox[1][1]=(r||0)+i}else console.log(t.x,t.y,t.width,t.height,i),this.bbox[0][0]=Math.min(this.bbox[0][0],t.x-i),this.bbox[0][1]=Math.min(this.bbox[0][1],t.y-i),this.bbox[1][0]=Math.max(this.bbox[1][0],t.x+t.width+i),this.bbox[1][1]=Math.max(this.bbox[1][1],t.y+t.height+i);return this.updateExtent(),this.zoom.translateExtent(this.bbox),this},p.GraphEditor.prototype.updateExtent=function(){var t=this.svg.node().getBoundingClientRect(),e=[[0,0],[t.width,t.height]];return this.zoom.extent(e),this},p.GraphEditor.prototype.updateLink=function(t){var e=this;t=e.getElement(t);var i=a.select("#"+t.datum().defId);return p.Link.updateSelection(t,i,e.options.link,function(t){return e.transition(t,"drag","update-link")}),this},p.GraphEditor.prototype.updateNode=function(e){var i=this,t=(e=this.getElement(e)).datum(),n=e.attr("transform"),s="translate(".concat(t.x,",",t.y,")"),o=t.width,r=t.height,a=function(t){return i.transition(t,"drag","update-node")};if(p.Node.updateSelection(e,a,this.textSize),s!==n||t.width!==o||t.height!==r){e=t;var h=function(t){return t.source===e||t.target===e},d=this.defs.filter(h),l=this.links.filter(h);p.Link.updateSelection(l,d,i.options.link,a),this.updateBBox(e)}return this},p.GraphEditor.prototype.update=function(t){var e=this,i=this.options,n=t?"simulation":"drag",s=function(t){return e.transition(t,n,"update")};this.nodes=this.nodes.data(this.data.nodes,p.id),this.nodes.exit().remove();var o=this.nodes.enter().append("g").classed(i.css.node,!0);p.Node.initSelection(o),this.nodes=o.merge(this.nodes),p.Node.updateSelection(this.nodes,s,this.textSize),this.nodeEvents(o),this.defs=this.defs.data(this.data.links,p.id),this.defs.exit().remove();var r=this.defs.enter().append("path");this.links=this.links.data(this.data.links,p.id),this.links.exit().remove();var a=this.links.enter().append("g").classed(i.css.link,!0);return p.Link.initSelection(a,r,i.link),this.links=this.links.merge(a),this.defs=this.defs.merge(r),p.Link.updateSelection(this.links,this.defs,i.link,s),this.linkEvents(a),this.updateBBox(),t||(this.updateSimulation(),this.selectNode(this.state.selectedNode,!0)),this},t});